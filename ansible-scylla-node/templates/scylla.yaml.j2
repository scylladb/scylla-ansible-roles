# Configured by Ansible Scylla role
# Additional parameters can be edited right here for all-node distribution

cluster_name: "{{ scylla_cluster_name }}"

data_file_directories:
    - /var/lib/scylla/data

commitlog_directory: /var/lib/scylla/commitlog

{% if scylla_authentication is defined and scylla_authentication|bool %}
authenticator: PasswordAuthenticator
authorizer: CassandraAuthorizer
{% endif %}

num_tokens: 256
commitlog_sync: periodic
commitlog_sync_period_in_ms: 10000
commitlog_segment_size_in_mb: 32

seed_provider:
    - class_name: org.apache.cassandra.locator.SimpleSeedProvider
      parameters:
          - seeds: "{{ scylla_seeds | join(',') }}"

listen_address: {{ scylla_listen_address }}
native_transport_port: 9042
read_request_timeout_in_ms: 5000
write_request_timeout_in_ms: 2000
cas_contention_timeout_in_ms: 1000
endpoint_snitch: {{ scylla_snitch }}
rpc_address: {{ scylla_rpc_address }}
broadcast_address: {{ scylla_broadcast_address }}
broadcast_rpc_address: {{ scylla_broadcast_rpc_address }}
prometheus_address: {{ scylla_prometheus_address }}
rpc_port: 9160
api_port: {{ scylla_api_port }}
api_address: {{ scylla_api_address }}
batch_size_warn_threshold_in_kb: 128
batch_size_fail_threshold_in_kb: 1024
partitioner: org.apache.cassandra.dht.Murmur3Partitioner
commitlog_total_space_in_mb: -1
murmur3_partitioner_ignore_msb_bits: 12
api_ui_dir: /opt/scylladb/swagger-ui/dist/
api_doc_dir: /opt/scylladb/api/api-doc/

{% if ssl_client_enabled|bool %}
native_transport_port_ssl: 9142
native_shard_aware_transport_port_ssl: 19142

client_encryption_options:
    enabled: true
    certificate: {{ ssl_cert_path }}
    keyfile: {{ ssl_cert_key_path }}
{% if _truststore_exists %}
    truststore: {{ ssl_truststore_path }}
{% endif %}
{% endif %}

{% if ssl_internode_enabled|bool %}
server_encryption_options:
    internode_encryption: {{ ssl_internode_encryption }}
    certificate: {{ ssl_cert_path }}
    keyfile: {{ ssl_cert_key_path }}
{% if _truststore_exists %}
    truststore: {{ ssl_truststore_path }}
{% endif %}
{% endif %}
{% if handle_system_keys|bool %}
system_key_directory: {{ system_key_directory }}
{% endif %}
{% if system_info_encryption_local.enabled|bool %}
system_info_encryption:
    enabled: True
    cipher_algorithm: {{ system_info_encryption_local.cipher_algorithm }}
    secret_key_strength: {{ system_info_encryption_local.secret_key_strength }}
    key_provider: LocalFileSystemKeyProviderFactory
    secret_key_file: {{ system_info_encryption_local.secret_key_file }}
{% elif system_info_encryption_kmip.enabled|bool %}
system_info_encryption:
    enabled: True
    cipher_algorithm: {{ system_info_encryption_kmip.cipher_algorithm }}
    secret_key_strength: {{ system_info_encryption_kmip.secret_key_strength }}
    key_provider: KmipKeyProviderFactory
    kmip_host: {{ system_info_encryption_kmip.kmip_host }}
{% elif system_info_encryption_kms.enabled|bool %}
system_info_encryption:
    enabled: True
    cipher_algorithm: {{ system_info_encryption_kms.cipher_algorithm }}
    secret_key_strength: {{ system_info_encryption_kms.secret_key_strength }}
    key_provider: KmsKeyProviderFactory
    kms_host: {{ system_info_encryption_kms.kms_host }}
{% endif %}
