---

# Facts gathering
- name: Populate service facts
  ansible.builtin.service_facts:

- name: Populate package facts
  package_facts:
    manager: auto

- name: Set Scylla package prefix as OSS
  set_fact:
    scylla_package_prefix: "scylla"
  when: scylla_edition == 'oss'

- name: Set Scylla package prefix as Enterprise
  set_fact:
    scylla_package_prefix: "scylla-enterprise"
  when: scylla_edition == 'enterprise'

# Upgrade
- name: Upgrade Scylla
  include_tasks: upgrade/main.yml
  when: upgrade_version

# Install
- name: os-specific tasks
  include_tasks: "{{ ansible_os_family }}.yml"
  when: not upgrade_version

- name: common tasks
  include_tasks: common.yml
  when: not upgrade_version and install_only|bool == false

